"use strict";var akoenig=akoenig||{};akoenig.cinnamon=angular.module("akoenig.cinnamon",["ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeController"}).otherwise({redirectTo:"/"})}]),akoenig.cinnamon.controller("HomeController",["$scope","BuildService","LogfileService",function(a,b,c){a.loading=!0,b.list().then(function(b){a.builds=b,a.loading=!1}),a.isClearable=function(){var b=!1;return a.builds&&a.builds.length?(a.builds.forEach(function(a){!b&&a.running&&(b=!0)}),!b):!1},a.clear=function(){var c;window.confirm("Sure?")&&(c=[],a.builds.forEach(function(a){c.push(function(c){b.remove(a.id).then(c,c)})}),async.parallel(c,function(){a.builds=b.list()}))},a.toggleLogfile=function(a){a.showLogfile?a.showLogfile=!1:c.findByDirectory(a.directory).then(function(b){a.logfile=b,a.showLogfile=!0},function(b){a.logfile=404===b.status?'Log file does not exist.\n\nHave you piped the output from your tests to "cinnamon.log"?':"Error while loading logfile.",a.showLogfile=!0})}}]),akoenig.cinnamon.service("ConfigService",[function(){var a=function(a){var b=window.location.protocol+"//"+window.location.host,c=b+(a?"/api":""),d=9e3,e=7777;return-1!==c.indexOf(d)&&(c=c.replace(d,e)),c};this.getApiEndpoint=function(){return a(!0)},this.getEndpoint=function(){return a()}}]),akoenig.cinnamon.service("BuildService",["$q","$http","ConfigService",function(a,b,c){var d=c.getApiEndpoint()+"/builds";this.list=function(){var c=a.defer();return b.get(d).success(function(a){c.resolve(a)}).error(function(a,b){c.reject({status:b,data:a})}),c.promise},this.remove=function(c){var e=a.defer();return b.delete(d+"/"+c).success(function(){e.resolve()}).error(function(a,b){e.reject({status:b,data:a})}),e.promise}}]),akoenig.cinnamon.service("LogfileService",["$q","$http","ConfigService",function(a,b,c){var d=c.getApiEndpoint()+"/logfiles";this.findByDirectory=function(c){var e=a.defer();return b.get(d+"/"+c).success(function(a){e.resolve(a)}).error(function(a,b){e.reject({status:b,data:a})}),e.promise}}]);